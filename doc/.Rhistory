group_by(year,month) %>%
summarise(count = n())
airport.data <- dataset %>%
select(Local.Event.Date,Event.State,Event.Airport,Operator,Aircraft.Make) %>%
mutate(year = year(Local.Event.Date)) %>%
group_by(year,Event.State) %>%
summarise(count = n()) %>%
arrange(year,Event.State)
major.company = c("LOCKHEED","BOEING","AIRBUS")
aircraft.make <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Aircraft.Make,AIDS.Report.Number,year) %>%
filter(Aircraft.Make %in% major.company) %>%
group_by(Aircraft.Make,year) %>%
summarise(count = n())  %>%
arrange(desc(count))
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "") %>%
group_by(Operator,year) %>%
summarise(count = n())
operator$Operator
unique(operator$Operator)
major.operator = c("AMERICAN AIRLINES","ALASKA AIRLINES","JETBLUE","DELTA AIR","ATLANTIC SOUTHEAST",
"FRONTIER AIRLINES","HAWAIIAN AIRLINES","AMERICAN EAGLE","SPIRIT AIRLINES",
"SKYWEST AIRLINES","US AIRWAYS","UNITED AIRLINES","SOUTHWEST AIRLINES")
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "",Operator %in% major.operator) %>%
group_by(Operator,year) %>%
summarise(count = n())
operator
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "",Operator %in% major.operator) %>%
group_by(Operator,year) %>%
summarise(count = n())
major.operator = c("AMERICAN AIRLINES INC","ALASKA AIRLINES INC","JETBLUE INC","DELTA AIR INC","ATLANTIC SOUTHEAST INC",
"FRONTIER AIRLINES INC","HAWAIIAN AIRLINES INC","AMERICAN EAGLE","SPIRIT AIRLINES INC",
"SKYWEST AIRLINES INC","US AIRWAYS INC","UNITED AIRLINES INC","SOUTHWEST AIRLINES INC")
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "",Operator %in% major.operator) %>%
group_by(Operator,year) %>%
summarise(count = n())
operator$Operator
unique(operator$Operator)
View(operator)
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "") %>%
group_by(Operator,year) %>%
summarise(count = n())
gsub(c(',','.'),replacement = "",operator)
gsub(',',replacement = "",operator$Operator)
operator <- operator %>%
gsub(',',replacement = "",Operator) %>%
gsub('.',replacement = "",Operator)
operator <- operator %>%
gsub(',',replacement = "",.Operator) %>%
gsub('.',replacement = "",Operator)
operator <- operator %>%
gsub(',',replacement = "",.Operator) %>%
gsub('.',replacement = "",.Operator)
gsub(',',replacement = "") %>%
gsub('.',replacement = "")
gsub(',',replacement = "",x = .) %>%
gsub('.',replacement = "",x = .)
gsub(',',replacement = "",.) %>%
gsub('.',replacement = "",.)
major.operator = c("DELTA AIR LINES INC","SPIRIT AIRLINES INC","JETBLUE AIRWAYS CORPORATION",
"UNITED AIRLINES, INC.","UNITED AIR LINES INC","FRONTIER AIRLINES INC","ALASKA AIRLINES INC",
"SOUTHWEST AIRLINES CO","HAWAIIAN AIRLINES INC","AMERICAN AIRLINES INC",
"SKYWEST AIRLINES INC","EXPRESSJET AIRLINES INC","ENVOY AIR INC")
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "") %>%
group_by(Operator,year) %>%
summarise(count = n())
operator <- gsub('UNITED AIR LINES INC',replacement = "UNITED AIRLINES, INC.", operator)
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "") %>%
group_by(Operator,year) %>%
summarise(count = n())
operator$Operator <- gsub('UNITED AIR LINES INC',replacement = "UNITED AIRLINES, INC.",operator$Operator)
major.operator = c("DELTA AIR LINES INC","SPIRIT AIRLINES INC","JETBLUE AIRWAYS CORPORATION",
"UNITED AIRLINES, INC.","UNITED AIR LINES INC","FRONTIER AIRLINES INC","ALASKA AIRLINES INC",
"SOUTHWEST AIRLINES CO","HAWAIIAN AIRLINES INC","AMERICAN AIRLINES INC",
"SKYWEST AIRLINES INC","EXPRESSJET AIRLINES INC","ENVOY AIR INC")
operator <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Operator,AIDS.Report.Number,year) %>%
filter(Operator != "",Operator %in% major.operator) %>%
group_by(Operator,year) %>%
summarise(count = n())
operator$Operator <- gsub('UNITED AIR LINES INC',replacement = "UNITED AIRLINES, INC.",operator$Operator)
unique(operator$Operator)
write.csv(new, file = "accident_month.csv", row.names = TRUE)
write.csv(new, file = "accident_state.csv", row.names = TRUE)
write.csv(new, file = "accident_aircraft.csv", row.names = TRUE)
write.csv(new, file = "accident_operator.csv", row.names = TRUE)
write.csv(new, file = "../data/accident_month.csv", row.names = TRUE)
write.csv(new, file = "../data/accident_state.csv", row.names = TRUE)
write.csv(new, file = "../data/accident_aircraft.csv", row.names = TRUE)
write.csv(new, file = "../data/accident_operator.csv", row.names = TRUE)
operator
write.csv(month.data, file = "../data/accident_month.csv", row.names = TRUE)
write.csv(airport.data, file = "../data/accident_state.csv", row.names = TRUE)
write.csv(aircraft.make, file = "../data/accident_aircraft.csv", row.names = TRUE)
write.csv(operator, file = "../data/accident_operator.csv", row.names = TRUE)
library(shiny); runApp('accident.R')
knitr::opts_chunk$set(echo = TRUE)
month.data %>%
plot_ly(
x = ~month,
y = ~count,
frame = ~year,
text = ~count,
hoverinfo = "text",
linetype = I("dash"),
name = 'Accident Number'
)
str(month.data)
aircraft.make %>%
plot_ly(
x = ~year,
y = ~count,
split = ~aircraft.make,
color = ~aircraft.make,
frame = ~year,
type = 'scatter',
mode = 'lines'
)
aircraft.make
ggplot(aircraft.make,aes(x = year,y = count)) +
geom_line(color = aircraft.make)
ggplot(aircraft.make,aes(x = year,y = count,color = aircraft.make)) +
geom_line()
str(aircraft.make)
ggplot(aircraft.make,aes(x = year,y = count,color = aircraft.make)) +
geom_line()
ggplot(aircraft.make,aes(x = year,y = count)) +
geom_line()
ggplot(aircraft.make,aes(x = year,y = count,color = Aircraft.Make)) +
geom_line()
animate(a)
a <- ggplot(aircraft.make,aes(x = year,y = count,color = Aircraft.Make)) +
geom_line()
animate(a)
install.packages("gganimate")
library(gganimate)
a <- ggplot(aircraft.make,aes(x = year,y = count,color = Aircraft.Make)) +
geom_line()
animate(a)
devtools::install_github('thomasp85/gganimate')
library(gapminder)
library(gganimate)
animate(a)
help("~")
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
accumulate_by(~date)
dats <- lapply(seq_along(lvls), function(x) {
cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]])
})
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
accumulate_by(~date)
lvls <- plotly:::getLevels(var)
accumulate_by <- function(dat, var) {
var <- lazyeval::f_eval(var, dat)
lvls <- plotly:::getLevels(var)
dats <- lapply(seq_along(lvls), function(x) {
cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]])
})
dplyr::bind_rows(dats)
}
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
accumulate_by(~date)
View(d)
a <- d %>%
select(city,date,frame)
a
View(a)
a <- d %>%
select(city,date,frame,month,year)
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date) $>$
accumulate_by(~date)
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date) %>%
accumulate_by(~date)
d
aircraft.make
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median) %>%
accumulate_by(~date)
d %>%
plot_ly(
x = ~date,
y = ~median,
split = ~city,
frame = ~frame,
type = 'scatter',
mode = 'lines',
line = list(simplyfy = F)
) %>%
layout(
xaxis = list(
title = "Date",
zeroline = F
),
yaxis = list(
title = "Median",
zeroline = F
)
) %>%
animation_opts(
frame = 100,
transition = 0,
redraw = FALSE
) %>%
animation_slider(
hide = T
) %>%
animation_button(
x = 1, xanchor = "right", y = 0, yanchor = "bottom"
)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year) %>%
filter(aircraft.make %in% major.company) %>%
group_by(aircraft.make,year) %>%
summarise(count = n())  %>%
accumulate_by(~year)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year) %>%
filter(aircraft.make %in% major.company) %>%
group_by(aircraft.make,year) %>%
summarise(count = n())  %>%
mutate(year.month = paste(year,month)) %>%
accumulate_by(~year.month)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year) %>%
filter(aircraft.make %in% major.company) %>%
group_by(aircraft.make,year) %>%
summarise(count = n())  %>%
mutate(year.month = paste(year,month))
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = paste(year,month)) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())
str(dataset)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = paste(year,month))
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = paste(year,month)) %>%
group_by(aircraft.make,year.month) %>%
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = paste(year,month)) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = paste(year,month)) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())
dd
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = as.numeric(paste(year,month,sep = "."))) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())  %>%
accumulate_by(~year.month)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = as.numeric(paste(year,month,sep = "."))) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())
dd
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median)
d
str(d$median)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = as.numeric(paste(year,month,sep = "."))) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())  %>%
accumulate_by(~year.month)
dim(dd)
dim(d)
dd <- dataset %>%
mutate(year = year(Local.Event.Date),
month = month(Local.Event.Date),
aircraft.make = as.character(Aircraft.Make)) %>%
select(aircraft.make,AIDS.Report.Number,year,month) %>%
filter(aircraft.make %in% major.company) %>%
mutate(year.month = as.numeric(paste(year,month,sep = "."))) %>%
group_by(aircraft.make,year.month) %>%
summarise(count = n())  %>%
accumulate_by(year.month~)
print(dat)
accumulate_by <- function(dat, var) {
print(var)
var <- lazyeval::f_eval(var, dat)
lvls <- plotly:::getLevels(var)
dats <- lapply(seq_along(lvls), function(x) {
(cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]]))
})
dplyr::bind_rows(dats)
}
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median) %>%
accumulate_by(~date)
print(lvls)
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median) %>%
accumulate_by(~date)
print(seq_along(lvls))
dats <- lapply(seq_along(lvls), function(x) {
(cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]]))
})
accumulate_by <- function(dat, var) {
print(var)
var <- lazyeval::f_eval(var, dat)
print(var)
lvls <- plotly:::getLevels(var)
print(seq_along(lvls))
dats <- lapply(seq_along(lvls), function(x) {
(cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]]))
})
dplyr::bind_rows(dats)
}
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median) %>%
accumulate_by(~date)
cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]])
accumulate_by <- function(dat, var) {
print(var)
var <- lazyeval::f_eval(var, dat)
print(var)
lvls <- plotly:::getLevels(var)
print(seq_along(lvls))
dats <- lapply(seq_along(lvls), function(x) {
cbind(dat[var %in% lvls[seq(1, x)], ], frame = lvls[[x]])
})
dplyr::bind_rows(dats)
}
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median) %>%
accumulate_by(~date)
dd <- aircraft.make %>%
accumulate_by(~year)
d <- txhousing %>%
filter(year > 2005, city %in% c("Abilene", "Bay Area")) %>%
select(city,date,median) %>%
accumulate_by(~date)
d %>%
plot_ly(
x = ~date,
y = ~median,
split = ~city,
frame = ~frame,
type = 'scatter',
mode = 'lines',
line = list(simplyfy = F)
) %>%
layout(
xaxis = list(
title = "Date",
zeroline = F
),
yaxis = list(
title = "Median",
zeroline = F
)
) %>%
animation_opts(
frame = 100,
transition = 0,
redraw = FALSE
) %>%
animation_slider(
hide = T
) %>%
animation_button(
x = 1, xanchor = "right", y = 0, yanchor = "bottom"
)
a <- ggplot(aircraft.make,aes(x = year,y = count,color = Aircraft.Make)) +
geom_line()
animate(a)
dd
p <- ggplot(dd, aes(x, y)) +
geom_point(aes(frame = f))
gg <- ggplot(gapminder, aes(gdpPercap, lifeExp, color = continent))+
geom_point(aes(size = pop, frame = year, ids = country)) +
scale_x_log10()
ggplotly(gg)
gg <- ggplot(dd, aes(year.month, count, color = aircraft.make))+
geom_line(aes(frame = year.month))
ggplotly(gg)
gg
ggplotly(gg)
airport.data <- dataset %>%
select(Local.Event.Date,Event.State,Event.Airport,Operator,Aircraft.Make) %>%
mutate(year = year(Local.Event.Date)) %>%
group_by(year,Event.State) %>%
summarise(count = n()) %>%
arrange(year,Event.State)
aircraft.make <- dataset %>%
mutate(year = year(Local.Event.Date)) %>%
select(Aircraft.Make,AIDS.Report.Number,year) %>%
filter(Aircraft.Make %in% major.company) %>%
group_by(Aircraft.Make,year) %>%
summarise(count = n())  %>%
arrange(desc(count))
plot_ly(aircraft.make, x = ~year, y = ~count) %>%
add_lines(color = ~aircraft.make)
aircraft.make
plot_ly(aircraft.make, x = ~year, y = ~count) %>%
add_lines(color = ~Aircraft.Make)
plot_ly(aircraft.make, x = ~year, y = ~count) %>%
add_trace(color = ~Aircraft.Make)
plot_ly(aircraft.make, x = ~year, y = ~count) %>%
add_trace(color = ~Aircraft.Make,connectgaps = TRUE)
plot_ly(aircraft.make, x = year, y = count) %>%
add_trace(color = ~Aircraft.Make,connectgaps = TRUE)
plot_ly(aircraft.make, x = ~year, y = ~count[aircraft.make$Aircraft.Make == major.company[1]]) %>%
add_trace(color = ~Aircraft.Make,connectgaps = TRUE)
plot_ly(aircraft.make, x = ~year, y = ~count) %>%
add_lines(color = ~Aircraft.Make)
month.data %>%
plot_ly(
x = ~month,
y = ~count,
frame = ~year,
text = ~count,
hoverinfo = "text",
linetype = I("dash"),
name = 'Accident Number'
)
operator
plot_ly(operator, x = ~year, y = ~count) %>%
add_lines(color = ~Operator)
d <- event_data("plotly")
runApp('accident.R')
